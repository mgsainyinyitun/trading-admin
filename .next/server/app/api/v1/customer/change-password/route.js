"use strict";(()=>{var e={};e.id=3644,e.ids=[3644],e.modules={53524:e=>{e.exports=require("@prisma/client")},67096:e=>{e.exports=require("bcrypt")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},43839:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{POST:()=>c});var a=t(49303),n=t(88716),o=t(60670),i=t(90455),u=t(72331),p=t(87070),d=t(67096);async function c(e){let r=await (0,i.Ym)(e);if(!r)return p.NextResponse.json({error:"Unauthorized"},{status:401});let{oldPassword:t,newPassword:s}=await e.json(),a=await u._.customer.findUnique({where:{id:Number(r.id)}});if(!a)return p.NextResponse.json({error:"User not found"},{status:401});if(!t)return p.NextResponse.json({error:"No old password!"},{status:401});if(!await (0,d.compare)(t,a.password))return p.NextResponse.json({error:"Invalid Old password!"},{status:401});let n=await (0,d.hash)(s,10);return await u._.customer.update({where:{id:Number(r.id)},data:{password:n}}),p.NextResponse.json({message:"Password changed successfully"})}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/customer/change-password/route",pathname:"/api/v1/customer/change-password",filename:"route",bundlePath:"app/api/v1/customer/change-password/route"},resolvedPagePath:"C:\\Users\\sainyi\\Desktop\\projects\\others\\trading-admin\\app\\api\\v1\\customer\\change-password\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:h}=l,v="/api/v1/customer/change-password/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:w})}},90455:(e,r,t)=>{t.d(r,{Og:()=>p,Rp:()=>o,Ym:()=>i,so:()=>n});var s=t(24295),a=t(72331);function n(e){let r=e.headers.get("authorization");return r?.startsWith("Bearer ")?r.split(" ")[1]:null}async function o(e){try{if(await u(e))return null;let r=(0,s.WX)(e);return{id:r.customerId,email:r.email}}catch(e){return null}}async function i(e){let r=n(e);return r?o(r):null}async function u(e){let r=await a._.invalidtoken.findUnique({where:{token:e}});return!!r&&(!(r.expiresAt<new Date)||(await a._.invalidtoken.delete({where:{id:r.id}}),!1))}async function p(e,r){await a._.invalidtoken.create({data:{token:e,expiresAt:r}})}},24295:(e,r,t)=>{t.d(r,{RA:()=>o,WX:()=>i});var s=t(41482),a=t.n(s);let n=process.env.JWT_SECRET||"your-secret-key",o=e=>a().sign(e,n,{expiresIn:"30d"}),i=e=>{try{return a().verify(e,n)}catch(e){throw Error("Invalid token")}}},72331:(e,r,t)=>{t.d(r,{_:()=>a});var s=t(53524);let a=global.prisma||new s.PrismaClient({log:["query"]})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,1482],()=>t(43839));module.exports=s})();