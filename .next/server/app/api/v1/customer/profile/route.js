"use strict";(()=>{var e={};e.id=1339,e.ids=[1339],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},58817:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var n={};t.r(n),t.d(n,{GET:()=>l});var o=t(49303),a=t(88716),s=t(60670),i=t(87070),u=t(72331),c=t(53696);async function l(e){try{let r=await (0,c.H)(e);if(r.error)return i.NextResponse.json({error:r.error},{status:r.status});let t=r.customer?.id;if(!t)return i.NextResponse.json({error:"Customer ID not found"},{status:400});let n=await u._.customer.findUnique({where:{id:parseInt(t)},include:{address:{orderBy:{isDefault:"desc"}},account:{select:{id:!0,accountNo:!0,balance:!0,currency:!0,isActive:!0,createdAt:!0}}}});if(!n)return i.NextResponse.json({error:"Customer not found"},{status:404});let{password:o,socialSecurityNumber:a,...s}=n,l={...s,accounts:n.account.map(e=>({...e,balance:e.balance.toString()}))};return i.NextResponse.json({success:!0,data:l})}catch(e){return console.error("Error fetching customer profile:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/customer/profile/route",pathname:"/api/v1/customer/profile",filename:"route",bundlePath:"app/api/v1/customer/profile/route"},resolvedPagePath:"C:\\Users\\sainyi\\Desktop\\projects\\others\\trading-admin\\app\\api\\v1\\customer\\profile\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:m}=p,v="/api/v1/customer/profile/route";function h(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},90455:(e,r,t)=>{t.d(r,{Og:()=>c,Rp:()=>s,Ym:()=>i,so:()=>a});var n=t(24295),o=t(72331);function a(e){let r=e.headers.get("authorization");return r?.startsWith("Bearer ")?r.split(" ")[1]:null}async function s(e){try{if(await u(e))return null;let r=(0,n.WX)(e);return{id:r.customerId,email:r.email}}catch(e){return null}}async function i(e){let r=a(e);return r?s(r):null}async function u(e){let r=await o._.invalidtoken.findUnique({where:{token:e}});return!!r&&(!(r.expiresAt<new Date)||(await o._.invalidtoken.delete({where:{id:r.id}}),!1))}async function c(e,r){await o._.invalidtoken.create({data:{token:e,expiresAt:r}})}},24295:(e,r,t)=>{t.d(r,{RA:()=>s,WX:()=>i});var n=t(41482),o=t.n(n);let a=process.env.JWT_SECRET||"your-secret-key",s=e=>o().sign(e,a,{expiresIn:"30d"}),i=e=>{try{return o().verify(e,a)}catch(e){throw Error("Invalid token")}}},72331:(e,r,t)=>{t.d(r,{_:()=>o});var n=t(53524);let o=global.prisma||new n.PrismaClient({log:["query"]})},53696:(e,r,t)=>{t.d(r,{H:()=>o});var n=t(90455);async function o(e){try{let r=(0,n.so)(e);if(!r)return{error:"Authentication required",status:401};let t=await (0,n.Rp)(r);if(!t)return{error:"Invalid or expired token",status:401};return{customer:t,status:200}}catch(e){return console.error("Error in authentication:",e),{error:"Authentication failed",status:500}}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[8948,5972,1482],()=>t(58817));module.exports=n})();