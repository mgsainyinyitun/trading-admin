"use strict";(()=>{var t={};t.id=1858,t.ids=[1858],t.modules={53524:t=>{t.exports=require("@prisma/client")},20399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:t=>{t.exports=require("buffer")},84770:t=>{t.exports=require("crypto")},76162:t=>{t.exports=require("stream")},21764:t=>{t.exports=require("util")},59339:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{GET:()=>m,POST:()=>l});var a=r(49303),i=r(88716),s=r(60670),o=r(87070),u=r(72331),c=r(90455),d=r(50650),p=r(96799);async function l(t){let e=await (0,c.Ym)(t);if(!e)return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await t.json(),n=p.dX.parse(r),a=await u._.account.findFirst({where:{customerId:Number(e.id),currency:n.currency}});if(!a)return o.NextResponse.json({error:"Account not found or access denied"},{status:404});if(!a.isActive)return o.NextResponse.json({error:"Account is inactive"},{status:400});if(a.balance.toNumber()<n.amount)return o.NextResponse.json({error:"Insufficient balance"},{status:400});let i=await u._.$transaction(async t=>({transaction:await t.transaction.create({data:{transactionId:(0,d.l)(),type:"WITHDRAWAL",amount:n.amount,address:n.address,currency:n.currency,description:n.description,status:"PENDING",accountId:a.id,updatedAt:new Date}})}));return o.NextResponse.json({message:"Withdrawal successful",transaction:{transactionId:i.transaction.transactionId,type:i.transaction.type,amount:i.transaction.amount,description:i.transaction.description,status:i.transaction.status,accountId:i.transaction.accountId,createdAt:i.transaction.createdAt,address:i.transaction.address,currency:i.transaction.currency}})}async function m(t){let e=await (0,c.Ym)(t);if(!e)return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await u._.account.findMany({where:{customerId:Number(e.id)}}),n=[];for(let t of r){let e=await u._.transaction.findMany({where:{accountId:t.id,type:"WITHDRAWAL"}});n.push(e)}return o.NextResponse.json(n)}let f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/v1/transactions/withdrawal/route",pathname:"/api/v1/transactions/withdrawal",filename:"route",bundlePath:"app/api/v1/transactions/withdrawal/route"},resolvedPagePath:"C:\\Users\\sainyi\\Desktop\\projects\\others\\trading-admin\\app\\api\\v1\\transactions\\withdrawal\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:h}=f,v="/api/v1/transactions/withdrawal/route";function b(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},90455:(t,e,r)=>{r.d(e,{Og:()=>c,Rp:()=>s,Ym:()=>o,so:()=>i});var n=r(24295),a=r(72331);function i(t){let e=t.headers.get("authorization");return e?.startsWith("Bearer ")?e.split(" ")[1]:null}async function s(t){try{if(await u(t))return null;let e=(0,n.WX)(t);return{id:e.customerId,email:e.email}}catch(t){return null}}async function o(t){let e=i(t);return e?s(e):null}async function u(t){let e=await a._.invalidtoken.findUnique({where:{token:t}});return!!e&&(!(e.expiresAt<new Date)||(await a._.invalidtoken.delete({where:{id:e.id}}),!1))}async function c(t,e){await a._.invalidtoken.create({data:{token:t,expiresAt:e}})}},24295:(t,e,r)=>{r.d(e,{RA:()=>s,WX:()=>o});var n=r(41482),a=r.n(n);let i=process.env.JWT_SECRET||"your-secret-key",s=t=>a().sign(t,i,{expiresIn:"30d"}),o=t=>{try{return a().verify(t,i)}catch(t){throw Error("Invalid token")}}},72331:(t,e,r)=>{r.d(e,{_:()=>a});var n=r(53524);let a=global.prisma||new n.PrismaClient({log:["query"]})},50650:(t,e,r)=>{function n(){let t=Date.now().toString(36),e=Math.random().toString(36).substring(2,8);return`TXN${t}${e}`.toUpperCase()}function a(t,e){if(!t)return!1;{let r=Math.random()<=t;return r&&(r=Math.random()<=e),r}}r.d(e,{V:()=>a,l:()=>n})},96799:(t,e,r)=>{r.d(e,{$y:()=>u,GE:()=>s,X5:()=>o,dX:()=>i,p$:()=>a});var n=r(7410);let a=n.z.object({accountNo:n.z.string().min(1,"Account number is required"),amount:n.z.string().or(n.z.number()).transform(t=>{let e="string"==typeof t?parseFloat(t):t;if(isNaN(e)||e<=0)throw Error("Amount must be a positive number");return e}),description:n.z.string().optional()}),i=n.z.object({address:n.z.string().min(1,"Address is required"),currency:n.z.string(),amount:n.z.string().or(n.z.number()).transform(t=>{let e="string"==typeof t?parseFloat(t):t;if(isNaN(e)||e<=0)throw Error("Amount must be a positive number");return e}),description:n.z.string().optional()}),s=n.z.object({customerId:n.z.number().int().positive(),currency:n.z.string().min(1),tradeType:n.z.enum(["SHORT","LONG"]),period:n.z.number().int().positive(),tradeQuantity:n.z.number().int().positive()}),o=n.z.object({customerId:n.z.number().int().positive(),tradeId:n.z.number().int().positive(),outcome:n.z.enum(["win","lose"]).nullable()}),u=n.z.object({currency:n.z.string().min(1,"Currency is required"),amount:n.z.string().or(n.z.number()).transform(t=>{let e="string"==typeof t?Number.parseFloat(t):t;if(isNaN(e)||e<=0)throw Error("Amount must be a positive number");return e}),description:n.z.string().optional()})}};var e=require("../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),n=e.X(0,[8948,5972,1482,7410],()=>r(59339));module.exports=n})();